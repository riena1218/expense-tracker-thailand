<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bicycle THB Tracker - Â∞èÈ®éÂÖµË®òÂ∏≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        @keyframes bike-move {
            0% { transform: translateX(-200px); }
            100% { transform: translateX(calc(100vw + 200px)); }
        }
        @keyframes wheel-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-bike-move {
            animation: bike-move 20s linear infinite;
        }
        .animate-wheel-spin {
            animation: wheel-spin 1.2s linear infinite;
        }
        .dropdown-animate {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: top;
        }
        .hidden-dropdown {
            opacity: 0;
            transform: scaleY(0);
            pointer-events: none;
        }
        .visible-dropdown {
            opacity: 1;
            transform: scaleY(1);
            pointer-events: auto;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Animated Background -->
    <div class="fixed inset-0 pointer-events-none -z-10 overflow-hidden opacity-10">
        <div class="absolute bottom-10 animate-bike-move">
            <svg width="200" height="120" viewBox="0 0 200 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-slate-900">
                <circle cx="50" cy="80" r="30" stroke="currentColor" stroke-width="4" class="animate-wheel-spin origin-[50px_80px]" />
                <path d="M50 50 L50 110 M20 80 L80 80" stroke="currentColor" stroke-width="1" class="animate-wheel-spin origin-[50px_80px]" />
                <circle cx="150" cy="80" r="30" stroke="currentColor" stroke-width="4" class="animate-wheel-spin origin-[150px_80px]" />
                <path d="M150 50 L150 110 M120 80 L180 80" stroke="currentColor" stroke-width="1" class="animate-wheel-spin origin-[150px_80px]" />
                <path d="M50 80 L90 80 L120 50 L150 80 M90 80 L80 40 M120 50 L110 30" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                <path d="M70 40 L90 40 M100 30 L120 30" stroke="currentColor" stroke-width="6" stroke-linecap="round" />
            </svg>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-4 pt-10">
        <header class="mb-10 text-center">
            <h1 class="text-4xl md:text-5xl font-black text-slate-800 tracking-tight flex items-center justify-center gap-3">
                <span class="bg-blue-600 text-white px-3 py-1 rounded-2xl rotate-[-2deg]">THB</span>
                <span>Â∞èÈ®éÂÖµË®òÂ∏≥</span>
            </h1>
            <p class="text-slate-500 mt-2 font-medium">ÊÇ†ÈÅäÊ≥∞ÂúãÔºåÈ†êÁÆóÊàëÊúâ</p>
        </header>

        <!-- Main Stats -->
        <div class="glass rounded-[2rem] p-8 shadow-2xl mb-8 relative overflow-hidden text-center">
            <div class="absolute top-0 right-0 p-4">
                <button onclick="clearAllData()" class="text-[10px] uppercase font-bold text-slate-300 hover:text-rose-400 transition-colors">
                    Ê∏ÖÁ©∫Á¥ÄÈåÑ
                </button>
            </div>
            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">‰ªäÊó•Á∏ΩËä±Ë≤ª</span>
            <div class="flex items-baseline justify-center gap-2">
                <span id="today-total-display" class="text-6xl font-black text-slate-800 tabular-nums">0</span>
                <span class="text-2xl font-bold text-slate-400">‡∏ø</span>
            </div>
            <div id="budget-alert-container" class="h-14 flex items-center justify-center mt-2">
                <!-- Alert injected here -->
            </div>
        </div>

        <!-- Weekly View -->
        <div id="weekly-calendar" class="w-full mb-8 overflow-x-auto pb-2">
            <div class="flex justify-between gap-3 min-w-[500px]" id="calendar-grid">
                <!-- Days injected here -->
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
            <!-- Form -->
            <div class="glass rounded-3xl p-6 shadow-xl w-full">
                <form id="expense-form" class="space-y-4">
                    <div class="grid grid-cols-1 gap-4">
                        <div class="flex flex-col">
                            <label class="text-xs font-semibold text-slate-500 mb-1 ml-1 uppercase tracking-wider">Êó•Êúü</label>
                            <input type="date" id="input-date" required class="bg-white/50 border border-slate-200 rounded-2xl p-3 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all">
                        </div>

                        <div class="flex flex-col relative">
                            <label class="text-xs font-semibold text-slate-500 mb-1 ml-1 uppercase tracking-wider">È°ûÂà•</label>
                            <button type="button" id="category-toggle" class="flex items-center justify-between bg-white/50 border border-slate-200 rounded-2xl p-3 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all text-left">
                                <span id="selected-category-display" class="flex items-center gap-2">
                                    <span>üç≥</span>
                                    <span>Êó©È§ê</span>
                                </span>
                                <svg class="w-5 h-5 transition-transform" id="category-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <div id="category-dropdown" class="absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md border border-slate-200 rounded-2xl shadow-2xl z-50 overflow-hidden dropdown-animate hidden-dropdown">
                                <!-- Categories injected here -->
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <label class="text-xs font-semibold text-slate-500 mb-1 ml-1 uppercase tracking-wider">ÈáëÈ°ç (THB)</label>
                            <div class="relative">
                                <input type="number" id="input-amount" required placeholder="0.00" class="w-full bg-white/50 border border-slate-200 rounded-2xl p-3 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all text-lg font-bold pr-12">
                                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-xs uppercase">THB</span>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl transition-all active:scale-[0.98] shadow-lg flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        Êñ∞Â¢ûË®òÂ∏≥
                    </button>
                </form>
            </div>

            <!-- Chart -->
            <div class="glass rounded-3xl p-6 shadow-xl w-full h-[400px] flex flex-col items-center">
                <h3 class="text-lg font-bold text-slate-700 mb-4 w-full text-center">È°ûÂà•Ëä±Ë≤ªÊØî‰æã</h3>
                <div class="relative w-full h-full">
                    <canvas id="category-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="mt-12 bg-white/40 rounded-3xl p-6">
            <h3 class="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                ËøëÊúüË®òÂ∏≥
            </h3>
            <div id="transactions-list" class="space-y-3">
                <!-- Transactions injected here -->
            </div>
        </div>

        <footer class="mt-16 text-center">
            <div class="inline-block bg-white/50 backdrop-blur-sm px-6 py-2 rounded-full border border-pink-100 shadow-sm">
                <span class="text-sm font-medium text-slate-400">
                    Designed by <span class="text-pink-500 font-bold">Reinaü©∑</span>
                </span>
            </div>
        </footer>
    </main>

    <script>
        // Constants & Config
        const STORAGE_KEY = 'bicycle_thb_tracker_v1';
        const BUDGET_LIMIT_WARNING = 800;
        const BUDGET_LIMIT_CRITICAL = 1000;
        const CATEGORIES = [
            { name: 'Êó©È§ê', emoji: 'üç≥', color: '#fbbf24' },
            { name: 'ÂçàÈ§ê', emoji: 'üçú', color: '#f87171' },
            { name: 'Ë£úÁµ¶', emoji: 'ü•§', color: '#60a5fa' },
            { name: '‰ΩèÂÆø', emoji: 'üè®', color: '#818cf8' },
            { name: 'ÈõúÊîØ', emoji: 'üì¶', color: '#9ca3af' },
            { name: 'Â®õÊ®ÇÈ†ÖÁõÆ', emoji: 'üé°', color: '#c084fc' },
        ];

        let expenses = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let selectedCategory = CATEGORIES[0].name;
        let chartInstance = null;

        // Elements
        const expenseForm = document.getElementById('expense-form');
        const inputDate = document.getElementById('input-date');
        const inputAmount = document.getElementById('input-amount');
        const categoryToggle = document.getElementById('category-toggle');
        const categoryDropdown = document.getElementById('category-dropdown');
        const categoryArrow = document.getElementById('category-arrow');
        const selectedCatDisplay = document.getElementById('selected-category-display');
        const todayTotalDisplay = document.getElementById('today-total-display');
        const alertContainer = document.getElementById('budget-alert-container');
        const calendarGrid = document.getElementById('calendar-grid');
        const transactionsList = document.getElementById('transactions-list');
        const chartCanvas = document.getElementById('category-chart');

        // Initialization
        function init() {
            inputDate.value = new Date().toISOString().split('T')[0];
            renderCategories();
            updateUI();
        }

        function renderCategories() {
            categoryDropdown.innerHTML = '';
            CATEGORIES.forEach(cat => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-50 transition-colors text-slate-700';
                btn.innerHTML = `<span class="text-xl">${cat.emoji}</span><span class="font-medium">${cat.name}</span>`;
                btn.onclick = () => selectCategory(cat.name);
                categoryDropdown.appendChild(btn);
            });
        }

        function selectCategory(name) {
            selectedCategory = name;
            const cat = CATEGORIES.find(c => c.name === name);
            selectedCatDisplay.innerHTML = `<span>${cat.emoji}</span><span>${cat.name}</span>`;
            toggleDropdown(false);
        }

        function toggleDropdown(show) {
            if (show) {
                categoryDropdown.classList.remove('hidden-dropdown');
                categoryDropdown.classList.add('visible-dropdown');
                categoryArrow.classList.add('rotate-180');
            } else {
                categoryDropdown.classList.add('hidden-dropdown');
                categoryDropdown.classList.remove('visible-dropdown');
                categoryArrow.classList.remove('rotate-180');
            }
        }

        categoryToggle.onclick = (e) => {
            e.stopPropagation();
            const isOpen = categoryDropdown.classList.contains('visible-dropdown');
            toggleDropdown(!isOpen);
        };

        window.onclick = () => toggleDropdown(false);

        expenseForm.onsubmit = (e) => {
            e.preventDefault();
            const amount = parseFloat(inputAmount.value);
            const date = inputDate.value;
            if (!amount || !date) return;

            const newExpense = {
                id: Date.now().toString(),
                date,
                amount,
                category: selectedCategory
            };

            expenses.unshift(newExpense);
            saveData();
            inputAmount.value = '';
            updateUI();
        };

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
        }

        function clearAllData() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁ¥ÄÈåÑÂóéÔºü')) {
                expenses = [];
                saveData();
                updateUI();
            }
        }

        function updateUI() {
            renderTodayTotal();
            renderWeeklyCalendar();
            renderTransactions();
            renderChart();
        }

        function renderTodayTotal() {
            const today = new Date().toISOString().split('T')[0];
            const total = expenses
                .filter(e => e.date === today)
                .reduce((sum, e) => sum + e.amount, 0);

            todayTotalDisplay.innerText = total.toLocaleString();

            alertContainer.innerHTML = '';
            if (total >= BUDGET_LIMIT_CRITICAL) {
                alertContainer.innerHTML = `<div class="px-6 py-2 rounded-full border-2 font-bold animate-bounce text-rose-600 bg-rose-50 border-rose-200 text-lg shadow-sm">Â∞èÂøÉÂêÉÂúüü™èü´†</div>`;
            } else if (total >= BUDGET_LIMIT_WARNING) {
                alertContainer.innerHTML = `<div class="px-6 py-2 rounded-full border-2 font-bold animate-bounce text-orange-600 bg-orange-50 border-orange-200 text-lg shadow-sm">‚ö†Ô∏è‚ö†Ô∏èÈ†êÁÆó</div>`;
            }
        }

        function renderWeeklyCalendar() {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday

            calendarGrid.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const dayStr = day.toISOString().split('T')[0];
                const dayTotal = expenses
                    .filter(e => e.date === dayStr)
                    .reduce((sum, e) => sum + e.amount, 0);

                const isToday = dayStr === todayStr;
                const dayName = day.toLocaleDateString('zh-TW', { weekday: 'short' });
                const dayNum = day.getDate();

                let statusClass = 'bg-slate-50 text-slate-400';
                if (dayTotal >= BUDGET_LIMIT_CRITICAL) statusClass = 'bg-rose-500 text-white';
                else if (dayTotal >= BUDGET_LIMIT_WARNING) statusClass = 'bg-orange-500 text-white';
                else if (dayTotal > 0) statusClass = 'bg-blue-100 text-blue-700';

                const dayDiv = document.createElement('div');
                dayDiv.className = `flex-1 flex flex-col items-center p-3 rounded-2xl transition-all duration-500 transform ${isToday ? 'ring-2 ring-blue-500 ring-offset-2 scale-105 shadow-md bg-white' : 'bg-white/40'}`;
                dayDiv.innerHTML = `
                    <span class="text-[10px] font-bold uppercase mb-1 ${isToday ? 'text-blue-500' : 'text-slate-400'}">${dayName}</span>
                    <span class="w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold mb-2 ${isToday ? 'bg-blue-600 text-white' : 'text-slate-600'}">${dayNum}</span>
                    <div class="w-full text-center py-2 px-1 rounded-xl text-[11px] font-bold truncate ${statusClass}">${dayTotal > 0 ? dayTotal + ' ‡∏ø' : '‚Äî'}</div>
                    ${isToday ? '<div class="mt-1 w-1.5 h-1.5 rounded-full bg-blue-500"></div>' : ''}
                `;
                calendarGrid.appendChild(dayDiv);
            }
        }

        function renderTransactions() {
            if (expenses.length === 0) {
                transactionsList.innerHTML = `<p class="text-center text-slate-400 italic py-8">ÈñãÂßãË®ò‰∏ã‰Ω†ÁöÑÁ¨¨‰∏ÄÁ≠ÜËä±Ë≤ªÂêßÔºÅ</p>`;
                return;
            }

            transactionsList.innerHTML = '';
            expenses.slice(0, 10).forEach(exp => {
                const cat = CATEGORIES.find(c => c.name === exp.category);
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-4 bg-white/60 hover:bg-white/90 rounded-2xl transition-all shadow-sm border border-white/40';
                item.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center text-2xl">${cat ? cat.emoji : '‚ùì'}</div>
                        <div>
                            <h4 class="font-bold text-slate-800">${exp.category}</h4>
                            <span class="text-xs text-slate-400 font-medium">${exp.date}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-black text-slate-800">${exp.amount} ‡∏ø</div>
                    </div>
                `;
                transactionsList.appendChild(item);
            });
        }

        function renderChart() {
            const dataMap = {};
            CATEGORIES.forEach(c => dataMap[c.name] = 0);
            
            // Only current week data for chart as requested
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            const startStr = startOfWeek.toISOString().split('T')[0];
            const endStr = endOfWeek.toISOString().split('T')[0];

            expenses.forEach(exp => {
                if (exp.date >= startStr && exp.date <= endStr) {
                    dataMap[exp.category] += exp.amount;
                }
            });

            const data = CATEGORIES.map(c => dataMap[c.name]);
            const total = data.reduce((a, b) => a + b, 0);

            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(chartCanvas, {
                type: 'doughnut',
                data: {
                    labels: CATEGORIES.map(c => `${c.emoji} ${c.name}`),
                    datasets: [{
                        data: data,
                        backgroundColor: CATEGORIES.map(c => c.color),
                        borderColor: 'transparent',
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 10 } } },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const val = ctx.raw;
                                    const perc = total > 0 ? ((val / total) * 100).toFixed(1) : 0;
                                    return ` ${val} THB (${perc}%)`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        init();
    </script>
</body>
</html>